class ApplicationController < ActionController::Base
  # protect_from_forgery with: :exception
  before_action :authenticate_user!

  before_action :configure_permitted_parameters, if: :devise_controller?

  before_action :setup_penalty

  def setup_penalty
    #need to add all other states in addition to CA and NY
    @fed_age_penalty = {20 => 0.635, 21 => 1, 22 => 1, 23 => 1, 24 => 1, 25 => 1.004, 26 => 1.024, 27 => 1.048, 28 => 1.087, 29 => 1.119, 30 => 1.135, 31 => 1.159, 32 => 1.183, 33 => 1.198, 34 => 1.214, 35 => 1.222, 36 => 1.23, 37 => 1.238, 38 => 1.246, 39 => 1.262, 40 => 1.278, 41 => 1.302, 42 => 1.325, 43 => 1.357, 44 => 1.397, 45 => 1.444, 46 => 1.5, 47 => 1.563, 48 => 1.635, 49 => 1.706, 50 => 1.786, 51 => 1.865, 52 => 1.952, 53 => 2.04, 54 => 2.135, 55 => 2.23, 56 => 2.333, 57 => 2.437, 58 => 2.548, 59 => 2.603, 60 => 2.714, 61 => 2.81, 62 => 2.873, 63 => 2.952, 64 => 3}
    @ny_age_penalty = {30 => 3}
    @vt_age_penalty = {}
    @ut_age_penalty = {20 => 0.635, 21 => 1, 22 => 1, 23 => 1, 24 => 1, 25 => 1.004, 26 => 1.024, 27 => 1.048, 28 => 1.087, 29 => 1.119, 30 => 1.3, 31 => 1.3, 32 => 1.3, 33 => 1.3, 34 => 1.3, 35 => 1.4, 36 => 1.4, 37 => 1.4, 38 => 1.4, 39 => 1.4, 40 => 1.4, 41 => 1.4, 42 => 1.4, 43 => 1.357, 44 => 1.4, 45 => 1.444, 46 => 1.5, 47 => 1.563, 48 => 1.635, 49 => 1.706, 50 => 1.786, 51 => 1.865, 52 => 1.952, 53 => 2.04, 54 => 2.135, 55 => 2.23, 56 => 2.333, 57 => 2.437, 58 => 2.548, 59 => 2.603, 60 => 2.714, 61 => 2.81, 62 => 2.873, 63 => 2.952, 64 => 3}
    @mn_age_penalty = {20 => 0.89, 21 => 1, 22 => 1, 23 => 1, 24 => 1, 25 => 1.004, 26 => 1.024, 27 => 1.048, 28 => 1.087, 29 => 1.119, 30 => 1.135, 31 => 1.159, 32 => 1.183, 33 => 1.198, 34 => 1.214, 35 => 1.222, 36 => 1.23, 37 => 1.238, 38 => 1.246, 39 => 1.262, 40 => 1.278, 41 => 1.302, 42 => 1.325, 43 => 1.357, 44 => 1.397, 45 => 1.444, 46 => 1.5, 47 => 1.563, 48 => 1.635, 49 => 1.706, 50 => 1.786, 51 => 1.865, 52 => 1.952, 53 => 2.04, 54 => 2.135, 55 => 2.23, 56 => 2.333, 57 => 2.437, 58 => 2.548, 59 => 2.603, 60 => 2.714, 61 => 2.81, 62 => 2.873, 63 => 2.952, 64 => 3}
    @ma_age_penalty = {20 => 0.635, 21 => 0.667, 22 => 0.667, 23 => 0.667, 24 => 0.667, 25 => 0.669, 26 => 0.683, 27 => 0.699, 28 => 0.725, 29 => 0.746, 30 => 0.867, 31 => 0.867, 32 => 0.867, 33 => 0.867, 34 => 0.867, 35 => 0.933, 36 => 0.933, 37 => 0.933, 38 => 0.933, 39 => 0.933, 40 => 0.933, 41 => 1.302, 42 => 1.325, 43 => 1.357, 44 => 1.397, 45 => 1.444, 46 => 1.5, 47 => 1.563, 48 => 1.635, 49 => 1.706, 50 => 1.786, 51 => 1.865, 52 => 1.952, 53 => 2.04, 54 => 2.135, 55 => 2.23, 56 => 2.333, 57 => 2.437, 58 => 2.548, 59 => 2.603, 60 => 2.714, 61 => 2.81, 62 => 2.873, 63 => 2.952, 64 => 3}
    @fed_smoker_penalty = {TRUE => 1.5, FALSE => 0}
    @ca_table = {:smoker => @fed_smoker_penalty, :age => @fed_age_penalty}
    @ny_table = {:smoker => @fed_smoker_penalty, :age => @ny_age_penalty}
    @penalty_table = {:CA => @ca_table, :NY => @ny_table}
  end

  protected

  def configure_permitted_parameters
    devise_parameter_sanitizer.permit(:sign_up, :keys => [:user_name, :birthday, :state, :tobacco_use, :estimated_cost])

    devise_parameter_sanitizer.permit(:account_update, :keys => [:user_name, :birthday, :state, :tobacco_use, :estimated_cost])
  end

  skip_before_action :verify_authenticity_token, raise: false
end
